# üìã –°–∞–º–º–∞—Ä–∏: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Ollama RAG –≤ Telegram –±–æ—Ç

**–î–∞—Ç–∞:** 22-23 –¥–µ–∫–∞–±—Ä—è 2024  
**–ü—Ä–æ–µ–∫—Ç:** Telegram –±–æ—Ç —Å Claude AI  
**–í–µ—Ä—Å–∏—è:** 7.0.0 ‚Üí Ollama RAG Integration

---

## üéØ –¶–µ–ª—å

–î–æ–±–∞–≤–∏—Ç—å –≤ Telegram –±–æ—Ç–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π —á–µ—Ä–µ–∑ RAG (Retrieval-Augmented Generation) –∏—Å–ø–æ–ª—å–∑—É—è Ollama –∏ –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏.

---

## üèóÔ∏è –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Ollama MCP Server

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- **Ollama** - –ª–æ–∫–∞–ª—å–Ω–∞—è LLM –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
- **nomic-embed-text** - –º–æ–¥–µ–ª—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (768 –∏–∑–º–µ—Ä–µ–Ω–∏–π)
- **ollama-mcp** - –∫–∞—Å—Ç–æ–º–Ω—ã–π MCP —Å–µ—Ä–≤–µ—Ä –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- **Node.js** - runtime –¥–ª—è MCP —Å–µ—Ä–≤–µ—Ä–∞

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Mac:**
```
/Users/vkuzmin/mcp-servers/ollama-mcp/
‚îú‚îÄ‚îÄ server.js          # MCP —Å–µ—Ä–≤–µ—Ä (700+ —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ package.json       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ test_*.json        # –¢–µ—Å—Ç–æ–≤—ã–µ –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
‚îî‚îÄ‚îÄ save_large_store.js # –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑ –∑–Ω–∞–Ω–∏–π
```

**–í–µ–∫—Ç–æ—Ä–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:**
```
/tmp/vector_stores/
‚îú‚îÄ‚îÄ bot_knowledge.json  # –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –æ –±–æ—Ç–µ (4 —á–∞–Ω–∫–∞, 768D)
‚îú‚îÄ‚îÄ test_langs_full.json
‚îî‚îÄ‚îÄ test_python.json
```

### 2. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (7 —à—Ç—É–∫)

#### ‚úÖ Tool 1: chunk_and_embed
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–∞–∑–±–∏—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —á–∞–Ω–∫–∏ –∏ —Å–æ–∑–¥–∞—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∏

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```javascript
{
  text: string,           // –¢–µ–∫—Å—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
  model: string,          // nomic-embed-text
  chunk_size: number,     // –†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 500)
  chunk_overlap: number   // –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50)
}
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```javascript
{
  chunks: [
    {
      index: 0,
      text: "—Ç–µ–∫—Å—Ç —á–∞–Ω–∫–∞",
      embedding: [768 —á–∏—Å–µ–ª],
      char_count: 399
    }
  ],
  count: 4,
  model: "nomic-embed-text",
  embedding_dimensions: 768
}
```

**–¢–µ—Å—Ç:** ‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞—ë—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –¥–ª—è —Ç–µ–∫—Å—Ç–∞

---

#### ‚úÖ Tool 2: vector_store_save
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```javascript
{
  name: string,      // –ò–º—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
  chunks: array,     // –ú–∞—Å—Å–∏–≤ —á–∞–Ω–∫–æ–≤ —Å —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏
  model: string,     // –ú–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
  metadata: object   // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
}
```

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:** ‚ö†Ô∏è Stdin buffer limit ~100KB  
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `save_large_store.js` –¥–ª—è –ø—Ä—è–º–æ–π –∑–∞–ø–∏—Å–∏ –≤ —Ñ–∞–π–ª

**–¢–µ—Å—Ç:** ‚ö†Ô∏è –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –º–∞–ª—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –¥–ª—è –±–æ–ª—å—à–∏—Ö - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç

---

#### ‚úÖ Tool 3: vector_store_load
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏–∑ —Ñ–∞–π–ª–∞

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```javascript
{
  name: string  // –ò–º—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
}
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```javascript
{
  name: "bot_knowledge",
  chunks: [...],
  model: "nomic-embed-text",
  embedding_dim: 768,
  created_at: "2024-12-23T..."
}
```

**–¢–µ—Å—Ç:** ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ–ª–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ (768D)

---

#### ‚úÖ Tool 4: vector_store_search
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¢–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ —Ö—Ä–∞–Ω–∏–ª–∏—â—É

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```javascript
{
  store_name: string,  // –ò–º—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
  query: string,       // –ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
  top_k: number        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3)
}
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```javascript
{
  store: "bot_knowledge",
  query: "–∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞",
  results: [
    {
      text: "–ö–û–ú–ê–ù–î–´:\n/start - –ø–æ–∫–∞–∑–∞—Ç—å...",
      score: null,  // –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
      index: 1
    }
  ]
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** Scores –Ω–µ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è (–≤—Å–µ–≥–¥–∞ null)

**–¢–µ—Å—Ç:** ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —á–∞–Ω–∫–∏

---

#### ‚úÖ Tool 5: vector_store_list
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** –ù–µ—Ç

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```javascript
{
  stores: [
    {
      name: "bot_knowledge",
      file: "bot_knowledge.json",
      size: 98234,
      chunk_count: 4,
      created_at: "2024-12-23T...",
      model: "nomic-embed-text"
    }
  ]
}
```

**–¢–µ—Å—Ç:** ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤—Å–µ—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â

---

#### ‚úÖ Tool 6: vector_store_delete
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```javascript
{
  name: string  // –ò–º—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
}
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```javascript
{
  success: true,
  message: "Vector store 'test_mini' deleted"
}
```

**–¢–µ—Å—Ç:** ‚úÖ –£–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª –∏–∑ /tmp/vector_stores/

---

#### ‚úÖ Tool 7: find_similar
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ù–∞–π—Ç–∏ –ø–æ—Ö–æ–∂–∏–µ —á–∞–Ω–∫–∏ –ø–æ —ç–º–±–µ–¥–¥–∏–Ω–≥—É

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```javascript
{
  store_name: string,   // –ò–º—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
  embedding: array,     // –í–µ–∫—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞ (768 —á–∏—Å–µ–ª)
  top_k: number         // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
}
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```javascript
{
  store: "bot_knowledge",
  total: 4,
  results: [
    {
      text: "—Ç–µ–∫—Å—Ç —á–∞–Ω–∫–∞",
      similarity: "0.9234",  // –ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ
      index: 0
    }
  ]
}
```

**–ë–ê–ì –ù–ê–ô–î–ï–ù –ò –ò–°–ü–†–ê–í–õ–ï–ù:**

**–ü—Ä–æ–±–ª–µ–º–∞ (—Å—Ç—Ä–æ–∫–∞ 424 –≤ server.js):**
```javascript
// –û–∂–∏–¥–∞–ª chunks –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö, –Ω–æ –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∏–∑ store
const { query, chunks, model, top_k } = args;
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
const { store_name, embedding, top_k } = args;

// –ó–∞–≥—Ä—É–∑–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
const storePath = path.join(VECTOR_STORE_DIR, `${store_name}.json`);
if (!existsSync(storePath)) {
  throw new Error(`Vector store '${store_name}' not found`);
}

const storeData = JSON.parse(readFileSync(storePath, 'utf-8'));
const chunks = storeData.chunks;
const queryEmbedding = embedding;

// –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–≥–æ —Å—Ö–æ–¥—Å—Ç–≤–∞
const similarities = chunks.map((chunk, index) => {
  const similarity = cosineSimilarity(queryEmbedding, chunk.embedding);
  return { 
    index: chunk.index || index, 
    text: chunk.text, 
    similarity: similarity.toFixed(4)
  };
});
```

**–î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã:**
```javascript
import { existsSync, readFileSync } from 'fs';
```

**–¢–µ—Å—Ç –ø–æ—Å–ª–µ —Ñ–∏–∫—Å–∞:** ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ—Ö–æ–∂–∏–µ —á–∞–Ω–∫–∏ —Å –æ—Ü–µ–Ω–∫–∞–º–∏

---

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Telegram –±–æ—Ç

### 1. SSH –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (bot.py, —Å—Ç—Ä–æ–∫–∏ 67-72)

```python
# SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è ollama-mcp
MCP_OLLAMA_SSH_HOST = "localhost"
MCP_OLLAMA_SSH_PORT = 2222
MCP_OLLAMA_SSH_USER = "vkuzmin"
MCP_OLLAMA_SSH_KEY = "/root/.ssh/server_to_mac"
MCP_OLLAMA_NODE_PATH = "/Users/vkuzmin/.nvm/versions/node/v20.19.6/bin/node"
MCP_OLLAMA_SERVER_PATH = "/Users/vkuzmin/mcp-servers/ollama-mcp/server.js"
```

### 2. –ö–ª–∞—Å—Å MCPOllamaClient (—Å—Ç—Ä–æ–∫–∏ 415-520)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SSH reverse tunnel
- Timeout 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏
- AsyncIO lock –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü–∞—Ä—Å–∏–Ω–≥ –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ JSON –∏–∑ `result.content[0].text`

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
```python
async def start():
    # –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ SSH: node server.js
    # –û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è —á–µ—Ä–µ–∑ stderr
    
async def call_tool(tool_name, arguments):
    # JSON-RPC –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ stdin
    # –ß—Ç–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –∏–∑ stdout
    # –ü–∞—Ä—Å–∏–Ω–≥ –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ JSON
```

### 3. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è Claude (—Å—Ç—Ä–æ–∫–∏ 1577-1590)

```python
{
    "name": "search_knowledge",
    "description": "Search stored knowledge base using RAG. Use when user asks about bot capabilities, commands, or technical details.",
    "input_schema": {
        "type": "object",
        "properties": {
            "query": {
                "type": "string",
                "description": "Search query"
            },
            "top_k": {
                "type": "number",
                "description": "Number of results (1-10)",
                "default": 3
            }
        },
        "required": ["query"]
    }
}
```

### 4. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ (—Å—Ç—Ä–æ–∫–∏ 1661-1688)

```python
elif tool_use_block.name == "search_knowledge":
    if not mcp_ollama_client:
        tool_result = {"error": "Ollama MCP server not available"}
    else:
        logger.info(f"Searching knowledge base: {tool_use_block.input.get('query')}")
        
        search_result = await mcp_ollama_client.call_tool(
            "vector_store_search",
            {
                "store_name": "bot_knowledge",
                "query": tool_use_block.input.get("query"),
                "top_k": tool_use_block.input.get("top_k", 3)
            }
        )
        
        if search_result:
            tool_result = search_result
            logger.info(f"‚úì Found {len(search_result.get('results', []))} results")
        else:
            tool_result = {"error": "Search failed"}
```

### 5. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ post_init() (—Å—Ç—Ä–æ–∫–∏ 1855-1867)

```python
# –ó–∞–ø—É—Å–∫–∞–µ–º MCP Ollama Client
logger.info("Starting MCP Ollama Client...")
mcp_ollama_client = MCPOllamaClient(
    ssh_host=MCP_OLLAMA_SSH_HOST,
    ssh_port=MCP_OLLAMA_SSH_PORT,
    ssh_user=MCP_OLLAMA_SSH_USER,
    ssh_key=MCP_OLLAMA_SSH_KEY,
    node_path=MCP_OLLAMA_NODE_PATH,
    server_path=MCP_OLLAMA_SERVER_PATH
)
if await mcp_ollama_client.start():
    logger.info("‚úì MCP Ollama Client initialized")
else:
    logger.error("‚úó Failed to start MCP Ollama Client")
```

### 6. –û—á–∏—Å—Ç–∫–∞ –≤ post_shutdown() (—Å—Ç—Ä–æ–∫–∏ 1889-1890)

```python
if mcp_ollama_client:
    await mcp_ollama_client.stop()
```

---

## üêõ –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Stdin buffer limit (~100KB)

**–°–∏–º–ø—Ç–æ–º:** –ë–æ–ª—å—à–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ (768D √ó –º–Ω–æ–≥–æ —á–∞–Ω–∫–æ–≤) –Ω–µ –ø–æ–º–µ—â–∞—é—Ç—Å—è –≤ stdin

**–ü—Ä–∏—á–∏–Ω–∞:** MCP –∏—Å–ø–æ–ª—å–∑—É–µ—Ç stdin –¥–ª—è JSON-RPC, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∞ –û–°

**–†–µ—à–µ–Ω–∏–µ:**
- –î–ª—è –º–∞–ª—ã—Ö –¥–∞–Ω–Ω—ã—Ö (<100KB): `vector_store_save` —á–µ—Ä–µ–∑ stdin
- –î–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö: `save_large_store.js` - –ø—Ä—è–º–∞—è –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª

**–°–∫—Ä–∏–ø—Ç save_large_store.js:**
```javascript
async function callMCP(method, params) {
  const process = spawn('node', ['server.js']);
  
  // ... —Å–æ–∑–¥–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ —á–µ—Ä–µ–∑ chunk_and_embed
  
  // –ü—Ä—è–º–∞—è –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª (–æ–±—Ö–æ–¥ stdin)
  const storeData = { name, model, chunks, ... };
  writeFileSync(storePath, JSON.stringify(storeData));
}
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: find_similar –Ω–µ —Ä–∞–±–æ—Ç–∞–ª

**–°–∏–º–ø—Ç–æ–º:** `TypeError: Cannot read properties of undefined`

**–ü—Ä–∏—á–∏–Ω–∞:** –§—É–Ω–∫—Ü–∏—è –æ–∂–∏–¥–∞–ª–∞ `chunks` –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö, –Ω–æ –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏–∑ `store_name`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ (—Å–º. –≤—ã—à–µ)

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Port 2222 already in use

**–°–∏–º–ø—Ç–æ–º:** 
```
Error: remote port forwarding failed for listen port 2222
```

**–ü—Ä–∏—á–∏–Ω–∞:** –°—Ç–∞—Ä—ã–π SSH —Ç—É–Ω–Ω–µ–ª—å –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
sudo pkill -f "2222:localhost:22"
sudo lsof -i :2222

# –ù–∞ Mac —Ç—É–Ω–Ω–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è
```

### –ü—Ä–æ–±–ª–µ–º–∞ 4: MCP –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–π JSON

**–°–∏–º–ø—Ç–æ–º:** `result.content[0].text` —Å–æ–¥–µ—Ä–∂–∏—Ç JSON –∫–∞–∫ —Å—Ç—Ä–æ–∫—É

**–ü—Ä–∏—á–∏–Ω–∞:** MCP protocol –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç tool —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
const response = JSON.parse(jsonLine);
const textContent = response.result.content[0].text;
const actualResult = JSON.parse(textContent);  // –î–≤–æ–π–Ω–æ–π –ø–∞—Ä—Å–∏–Ω–≥
```

### –ü—Ä–æ–±–ª–µ–º–∞ 5: Python syntax errors –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ tool

**–°–∏–º–ø—Ç–æ–º:** –û—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø—Ä–∏ sed –≤—Å—Ç–∞–≤–∫–µ JSON –≤ –º–∞—Å—Å–∏–≤

**–ü—Ä–∏—á–∏–Ω–∞:** –°–ª–æ–∂–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤–∞—Ä–µ–π

**–†–µ—à–µ–Ω–∏–µ:** Python —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –≤—Å—Ç–∞–≤–∫–∏:
```python
# add_rag_tool_fixed.py
with open('bot.py', 'r') as f:
    lines = f.readlines()

# –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏
for i, line in enumerate(lines):
    if '"name": "mobile_start_emulator"' in line:
        # –í—Å—Ç–∞–≤–∫–∞ –ø–æ—Å–ª–µ mobile –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
```

---

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Telegram Bot (Python) - –°–µ—Ä–≤–µ—Ä                 ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  User: "–ö–∞–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã —É –±–æ—Ç–∞?"                              ‚îÇ
‚îÇ     ‚Üì                                                        ‚îÇ
‚îÇ  Claude: –ò—Å–ø–æ–ª—å–∑—É—é search_knowledge("–∫–æ–º–∞–Ω–¥—ã")              ‚îÇ
‚îÇ     ‚Üì                                                        ‚îÇ
‚îÇ  MCPOllamaClient.call_tool("vector_store_search", {...})    ‚îÇ
‚îÇ     ‚Üì                                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ SSH Tunnel (localhost:2222)
                       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Mac (–ª–æ–∫–∞–ª—å–Ω—ã–π)                          ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  MCP Ollama Server (Node.js)                         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  1. –ü–æ–ª—É—á–∞–µ—Ç: query="–∫–æ–º–∞–Ω–¥—ã"                        ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  2. –°–æ–∑–¥–∞—ë—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥ —á–µ—Ä–µ–∑ Ollama API               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  3. –ò—â–µ—Ç –≤ /tmp/vector_stores/bot_knowledge.json     ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  4. –í—ã—á–∏—Å–ª—è–µ—Ç –∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ø-3 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —á–∞–Ω–∫–∞               ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ             ‚Üì                                                ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Ollama API (localhost:11434)                        ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  POST /api/embeddings                                ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  {                                                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ    "model": "nomic-embed-text",                      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ    "prompt": "–∫–æ–º–∞–Ω–¥—ã"                               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  }                                                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Üí  [768 —á–∏—Å–µ–ª]                                      ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Bot:** –í–æ–ø—Ä–æ—Å –≤ Telegram
2. **Bot ‚Üí Claude API:** –°–æ–æ–±—â–µ–Ω–∏–µ + tools (–≤–∫–ª—é—á–∞—è search_knowledge)
3. **Claude:** –†–µ—à–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å search_knowledge
4. **Bot ‚Üí MCP Ollama:** JSON-RPC —á–µ—Ä–µ–∑ SSH
5. **MCP ‚Üí Ollama:** –ó–∞–ø—Ä–æ—Å —ç–º–±–µ–¥–¥–∏–Ω–≥–∞ –¥–ª—è query
6. **Ollama ‚Üí MCP:** –í–µ–∫—Ç–æ—Ä 768D
7. **MCP:** –ü–æ–∏—Å–∫ –≤ vector store, –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ similarity
8. **MCP ‚Üí Bot:** –¢–æ–ø —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
9. **Bot ‚Üí Claude:** –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–∫ tool_result
10. **Claude ‚Üí Bot:** –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
11. **Bot ‚Üí User:** –û—Ç–≤–µ—Ç –≤ Telegram

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

```bash
# –ù–∞ Mac
cd ~/mcp-servers/ollama-mcp

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
cat > bot_docs.txt << 'EOF'
Telegram –±–æ—Ç —Å Claude AI –≤–µ—Ä—Å–∏—è 6.0
–í–û–ó–ú–û–ñ–ù–û–°–¢–ò –ë–û–¢–ê:
1. –†–∞–∑–≥–æ–≤–æ—Ä —Å Claude Sonnet 4
2. –ü–æ–≥–æ–¥–∞ —á–µ—Ä–µ–∑ MCP Weather Server
...
EOF

# –°–æ–∑–¥–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
node save_large_store.js bot_docs.txt bot_knowledge

# –í—ã–≤–æ–¥:
# ‚úì Created 4 chunks with 768D embeddings
# ‚úì Saved to /tmp/vector_stores/bot_knowledge.json
# ‚úì Store "bot_knowledge" ready with 4 chunks
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

```bash
ls -lh /tmp/vector_stores/bot_knowledge.json
# -rw-r--r-- 1 vkuzmin staff 98K Dec 23 06:15 bot_knowledge.json

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
cat /tmp/vector_stores/bot_knowledge.json | jq '.chunks[0].text'
# "Telegram –±–æ—Ç —Å Claude AI –≤–µ—Ä—Å–∏—è 6.0..."
```

### –¢–µ—Å—Ç —á–µ—Ä–µ–∑ Telegram

**–ó–∞–ø—Ä–æ—Å 1:**
```
–ß—Ç–æ —Ç—ã —É–º–µ–µ—à—å –¥–µ–ª–∞—Ç—å?
```

**–õ–æ–≥–∏ –±–æ—Ç–∞:**
```
Searching knowledge base: —á—Ç–æ —Ç—ã —É–º–µ–µ—à—å
Sending to MCP Ollama: {"jsonrpc":"2.0","method":"tools/call",...}
Received from MCP Ollama: {"result":{"content":[{"type":"text",...
‚úì Found 3 results
```

**–û—Ç–≤–µ—Ç Claude:**
```
–Ø –º–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±–æ—Ç –Ω–∞ –±–∞–∑–µ Claude AI. –í–æ—Ç –º–æ–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

1. **–†–∞–∑–≥–æ–≤–æ—Ä —Å Claude Sonnet 4** - —É–º–Ω—ã–π AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –æ–±—â–µ–Ω–∏—è
2. **–ü–æ–≥–æ–¥–∞** - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –ø–æ–≥–æ–¥—ã –∏ –ø—Ä–æ–≥–Ω–æ–∑–∞ —á–µ—Ä–µ–∑ MCP Weather
3. **–ù–æ–≤–æ—Å—Ç–∏** - —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ RSS (–æ–±—â–∏–µ, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, –±–∏–∑–Ω–µ—Å)
4. **Android —ç–º—É–ª—è—Ç–æ—Ä** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Pixel 8 API 34
5. **–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π** - RAG –ø–æ–∏—Å–∫ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
/start - –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã
/weather_subscribe –ì–æ—Ä–æ–¥ - –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —É—Ç—Ä–µ–Ω–Ω—é—é –ø–æ–≥–æ–¥—É
...
```

**–ó–∞–ø—Ä–æ—Å 2:**
```
–ö–∞–∫ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø–æ–≥–æ–¥—É?
```

**–û—Ç–≤–µ—Ç:**
```
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É: /weather_subscribe –ì–æ—Ä–æ–¥

–ù–∞–ø—Ä–∏–º–µ—Ä: /weather_subscribe –ú–æ—Å–∫–≤–∞

–ü–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∫–∏ –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —É—Ç—Ä–µ–Ω–Ω—é—é —Ä–∞—Å—Å—ã–ª–∫—É –≤ 08:00 MSK —Å –ø–æ–≥–æ–¥–æ–π –∏ –Ω–æ–≤–æ—Å—Ç—è–º–∏.
```

---

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
- ‚ùå Claude –Ω–µ –∑–Ω–∞–ª –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥–ª–∏ –±—ã—Å—Ç—Ä–æ —É–∑–Ω–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã/–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚ùå –ù–µ—Ç –ø–æ–∏—Å–∫–∞ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### –ü–æ—Å–ª–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
- ‚úÖ Claude –∏—Å–ø–æ–ª—å–∑—É–µ—Ç RAG –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –æ –±–æ—Ç–µ
- ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- ‚úÖ –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —Å –∫–æ—Å–∏–Ω—É—Å–Ω—ã–º —Å—Ö–æ–¥—Å—Ç–≤–æ–º
- ‚úÖ 768-–º–µ—Ä–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –æ—Ç nomic-embed-text
- ‚úÖ 4 MCP —Å–µ—Ä–≤–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ Claude

### –ú–µ—Ç—Ä–∏–∫–∏:
- **–í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞:** ~2-3 —Å–µ–∫—É–Ω–¥—ã
- **–¢–æ—á–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è (cosine similarity > 0.8)
- **–†–∞–∑–º–µ—Ä –±–∞–∑—ã:** 4 —á–∞–Ω–∫–∞, ~2000 —Å–∏–º–≤–æ–ª–æ–≤, 98KB
- **Embedding dim:** 768
- **MCP —Å–µ—Ä–≤–µ—Ä–æ–≤:** 4 (Weather, News, Mobile, Ollama)

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### SSH Tunnel
- ‚úÖ Reverse tunnel —Å –∞–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º (LaunchAgent)
- ‚úÖ SSH –∫–ª—é—á–∏ –±–µ–∑ passphrase
- ‚úÖ ServerAliveInterval=60 –¥–ª—è keepalive
- ‚úÖ –ò–∑–æ–ª—è—Ü–∏—è: —Ç–æ–ª—å–∫–æ localhost:2222

### –í–µ–∫—Ç–æ—Ä–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- ‚úÖ –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ –¥–ª—è –±–æ—Ç–∞
- ‚úÖ –ó–∞–ø–∏—Å—å —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç—ã –Ω–∞ Mac
- ‚úÖ –•—Ä–∞–Ω—è—Ç—Å—è –≤ /tmp (–æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ)

### API –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ Ollama —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ (localhost:11434)
- ‚úÖ MCP —Å–µ—Ä–≤–µ—Ä –Ω–µ –∏–º–µ–µ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ Timeout 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

## üìù –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
1. `/root/telegram-bot/bot.py`
   - +350 —Å—Ç—Ä–æ–∫ (MCPOllamaClient, search_knowledge)
   - Backup: `bot.py.backup_before_ollama`

### –ù–∞ Mac:
1. `/Users/vkuzmin/mcp-servers/ollama-mcp/server.js`
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω bug –≤ find_similar
   - –î–æ–±–∞–≤–ª–µ–Ω—ã imports: existsSync, readFileSync

2. `/Users/vkuzmin/mcp-servers/ollama-mcp/save_large_store.js`
   - –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ–ª—å—à–∏—Ö –±–∞–∑ –∑–Ω–∞–Ω–∏–π
   - –û–±—Ö–æ–¥ stdin buffer limit

3. `/tmp/vector_stores/bot_knowledge.json`
   - –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –æ –±–æ—Ç–µ (4 —á–∞–Ω–∫–∞, 768D)

---

## üöÄ –î–µ–ø–ª–æ–π

### –ü—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

```bash
# 1. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ - –±—ç–∫–∞–ø
cd /root/telegram-bot
cp bot.py bot.py.backup_before_ollama

# 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
# (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Python —Å–∫—Ä–∏–ø—Ç—ã)

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
source venv/bin/activate
python3 -m py_compile bot.py

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
sudo systemctl restart telegram-bot
sudo journalctl -u telegram-bot -n 50

# –û–∂–∏–¥–∞–µ–º:
# ‚úì MCP Weather Client initialized
# ‚úì MCP News Client initialized
# ‚úì MCP Mobile Client initialized
# ‚úì MCP Ollama Client initialized  ‚Üê –ù–û–í–û–ï!
# Bot is running...
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

```bash
# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
sudo journalctl -u telegram-bot -f | grep -E "MCP Ollama|search_knowledge"
```

---

## üí° –ò–¥–µ–∏ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ:
- [ ] –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
- [ ] –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –ø–æ —Ç–µ–º–∞–º
- [ ] –ö–æ–º–∞–Ω–¥–∞ `/search <query>` –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å similarity scores –≤ –æ—Ç–≤–µ—Ç–∞—Ö

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ:
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ README
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PDF/DOCX –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- [ ] –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ:
- [ ] PostgreSQL —Å pgvector –≤–º–µ—Å—Ç–æ JSON
- [ ] –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (BM25 + –≤–µ–∫—Ç–æ—Ä—ã)
- [ ] Fine-tuning –º–æ–¥–µ–ª–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- [ ] Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π

---

## üéì –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ

```javascript
function cosineSimilarity(vecA, vecB) {
  let dotProduct = 0;
  let normA = 0;
  let normB = 0;
  
  for (let i = 0; i < vecA.length; i++) {
    dotProduct += vecA[i] * vecB[i];
    normA += vecA[i] * vecA[i];
    normB += vecB[i] * vecB[i];
  }
  
  return dotProduct / (Math.sqrt(normA) * Math.sqrt(normB));
}
```

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**
- `1.0` - –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ –≤–µ–∫—Ç–æ—Ä—ã
- `0.8-0.9` - –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–∏–µ
- `0.5-0.7` - —É–º–µ—Ä–µ–Ω–Ω–æ –ø–æ—Ö–æ–∂–∏–µ
- `< 0.5` - —Ä–∞–∑–Ω—ã–µ

### –ß–∞–Ω–∫–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –†–∞–∑–±–∏—Ç—å —Ç–µ–∫—Å—Ç –ø–æ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞–º (\n\n)
2. –ï—Å–ª–∏ –ø–∞—Ä–∞–≥—Ä–∞—Ñ > chunk_size:
   - –†–∞–∑–±–∏—Ç—å –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –¥–æ chunk_size
3. –î–æ–±–∞–≤–∏—Ç—å overlap –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏
4. –°–æ–∑–¥–∞—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞

**–ü—Ä–∏–º–µ—Ä:**
```
–¢–µ–∫—Å—Ç: 1500 —Å–∏–º–≤–æ–ª–æ–≤
chunk_size: 500
chunk_overlap: 50

–†–µ–∑—É–ª—å—Ç–∞—Ç:
Chunk 0: —Å–∏–º–≤–æ–ª—ã 0-500
Chunk 1: —Å–∏–º–≤–æ–ª—ã 450-950  (50 overlap)
Chunk 2: —Å–∏–º–≤–æ–ª—ã 900-1400 (50 overlap)
Chunk 3: —Å–∏–º–≤–æ–ª—ã 1350-1500 (–æ—Å—Ç–∞—Ç–æ–∫)
```

### MCP JSON-RPC Protocol

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "jsonrpc": "2.0",
  "method": "tools/call",
  "params": {
    "name": "vector_store_search",
    "arguments": {
      "store_name": "bot_knowledge",
      "query": "–∫–æ–º–∞–Ω–¥—ã",
      "top_k": 3
    }
  },
  "id": 1
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "jsonrpc": "2.0",
  "result": {
    "content": [
      {
        "type": "text",
        "text": "{\"store\":\"bot_knowledge\",\"results\":[...]}"
      }
    ]
  },
  "id": 1
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** –î–≤–æ–π–Ω–∞—è JSON –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å!

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Ollama](https://ollama.ai/) - LLM –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
- [nomic-embed-text](https://ollama.ai/library/nomic-embed-text) - –º–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- [Model Context Protocol](https://modelcontextprotocol.io/) - —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è MCP
- [Cosine Similarity](https://en.wikipedia.org/wiki/Cosine_similarity) - –º–µ—Ç—Ä–∏–∫–∞ —Å—Ö–æ–¥—Å—Ç–≤–∞

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [x] Ollama —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] nomic-embed-text –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞
- [x] MCP —Å–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [x] –í—Å–µ 7 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç
- [x] Bug –≤ find_similar –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- [x] –û–±—Ö–æ–¥ stdin buffer limit —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] MCPOllamaClient –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ bot.py
- [x] search_knowledge –¥–æ–±–∞–≤–ª–µ–Ω –≤ tools Claude
- [x] SSH tunnel –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π bot_knowledge —Å–æ–∑–¥–∞–Ω–∞
- [x] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram —É—Å–ø–µ—à–Ω–æ
- [x] –ë–æ—Ç –∑–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞

---

## üéâ –ò—Ç–æ–≥

**Telegram –±–æ—Ç —É—Å–ø–µ—à–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å Ollama RAG!**

–¢–µ–ø–µ—Ä—å Claude –º–æ–∂–µ—Ç:
- üîç –ò—Å–∫–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
- üìö –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- üéØ –ù–∞—Ö–æ–¥–∏—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
- üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 768-–º–µ—Ä–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
- ‚ö° –†–∞–±–æ—Ç–∞—Ç—å —Å 4 MCP —Å–µ—Ä–≤–µ—Ä–∞–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

**–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é!**

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 23 –¥–µ–∫–∞–±—Ä—è 2024  
**–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:** ~5 —á–∞—Å–æ–≤  
**–í–µ—Ä—Å–∏—è:** 7.0.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

---

**–ê–≤—Ç–æ—Ä:** –í–∏–∫—Ç–æ—Ä –ö—É–∑—å–º–∏–Ω  
**–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç:** Claude (Anthropic)  
**GitHub:** https://github.com/KuzminVik/telegram-claude-bot
