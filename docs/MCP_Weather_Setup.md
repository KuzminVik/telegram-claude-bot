# üå§Ô∏è MCP Weather Integration - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

**–î–∞—Ç–∞:** 16 –¥–µ–∫–∞–±—Ä—è 2024  
**–í–µ—Ä—Å–∏—è:** 3.0.0

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ß—Ç–æ —Ç–∞–∫–æ–µ MCP?](#—á—Ç–æ-—Ç–∞–∫–æ–µ-mcp)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Ä–µ—à–µ–Ω–∏—è)
3. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
4. [–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç](#–∫–∞–∫-—ç—Ç–æ-—Ä–∞–±–æ—Ç–∞–µ—Ç)
5. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
6. [Troubleshooting](#troubleshooting)
7. [–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞](#—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞)

---

## üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ MCP?

**Model Context Protocol (MCP)** - —ç—Ç–æ –æ—Ç–∫—Ä—ã—Ç—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –æ—Ç Anthropic, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç AI –º–æ–¥–µ–ª—è–º (–≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏ Claude) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (tools).

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ MCP:

- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π Claude –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –µ–≥–æ –∫–æ–¥–∞
- ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
- ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Å–µ—Ä–≤–µ—Ä—ã (–º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –Ω–∞ –ª—é–±–æ–º —è–∑—ã–∫–µ)
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –º–µ–∂–¥—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏

### –í –Ω–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ:

–ú—ã —Å–æ–∑–¥–∞–ª–∏ **MCP Weather Server**, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç Claude –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `get_weather` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –ø–æ–≥–æ–¥—ã –∏–∑ Open-Meteo API.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                       ‚îÇ
‚îÇ  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç: "–ö–∞–∫–∞—è –ø–æ–≥–æ–¥–∞ –≤ –ú–æ—Å–∫–≤–µ?"       ‚îÇ
‚îÇ                                                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram Bot (Python)                                ‚îÇ
‚îÇ  ‚îú‚îÄ> –ü–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ                              ‚îÇ
‚îÇ  ‚îú‚îÄ> –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Claude API                         ‚îÇ
‚îÇ  ‚îî‚îÄ> Claude —Ä–µ—à–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  MCP Client (–≤ bot.py)                                ‚îÇ
‚îÇ  ‚îú‚îÄ> –ó–∞–ø—É—Å–∫–∞–µ—Ç MCP Server –∫–∞–∫ subprocess             ‚îÇ
‚îÇ  ‚îú‚îÄ> –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ stdio                   ‚îÇ
‚îÇ  ‚îî‚îÄ> –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ JSON                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  MCP Weather Server (Node.js)                         ‚îÇ
‚îÇ  ‚îú‚îÄ> server.js - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª                       ‚îÇ
‚îÇ  ‚îú‚îÄ> –ü–æ–ª—É—á–∞–µ—Ç –≥–æ—Ä–æ–¥ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞                       ‚îÇ
‚îÇ  ‚îú‚îÄ> –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (Geocoding API)          ‚îÇ
‚îÇ  ‚îî‚îÄ> –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–≥–æ–¥—É (Weather API)                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Open-Meteo API (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π)                          ‚îÇ
‚îÇ  ‚îú‚îÄ> https://geocoding-api.open-meteo.com            ‚îÇ
‚îÇ  ‚îî‚îÄ> https://api.open-meteo.com                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js

**–ù–∞ Ubuntu/Debian:**
```bash
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs

# –ü—Ä–æ–≤–µ—Ä–∫–∞
node --version  # v20.x.x
npm --version   # 10.x.x
```

**–ù–∞ macOS:**
```bash
brew install node@20
node --version
```

### –®–∞–≥ 2: –†–∞–∑–º–µ—â–µ–Ω–∏–µ MCP Weather Server

–í—ã–±–µ—Ä–∏—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è MCP —Å–µ—Ä–≤–µ—Ä–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:
```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –†—è–¥–æ–º —Å –±–æ—Ç–æ–º
mkdir -p /root/telegram-bot/mcp-weather
cd /root/telegram-bot/mcp-weather

# –í–∞—Ä–∏–∞–Ω—Ç 2: –û—Ç–¥–µ–ª—å–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
mkdir -p /opt/mcp-weather-server
cd /opt/mcp-weather-server

# –í–∞—Ä–∏–∞–Ω—Ç 3: –í –¥–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
mkdir -p ~/mcp-weather-server
cd ~/mcp-weather-server
```

### –®–∞–≥ 3: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –∏–∑ `mcp-weather-example/`:
```bash
# server.js - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ MCP —Å–µ—Ä–≤–µ—Ä–∞
# package.json - –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

cp /path/to/repo/mcp-weather-example/* /your/chosen/path/
```

### –®–∞–≥ 4: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd /your/chosen/path
npm install
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
added 96 packages, and audited 97 packages in 8s
found 0 vulnerabilities
```

### –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MCP —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –¢–µ—Å—Ç 1: –°–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
echo '{"jsonrpc":"2.0","method":"tools/list","id":1}' | node server.js

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ get_weather

# –¢–µ—Å—Ç 2: –ó–∞–ø—Ä–æ—Å –ø–æ–≥–æ–¥—ã
echo '{"jsonrpc":"2.0","method":"tools/call","params":{"name":"get_weather","arguments":{"city":"–ú–æ—Å–∫–≤–∞"}},"id":2}' | node server.js

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—É—é –ø–æ–≥–æ–¥—É
```

### –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ bot.py

–û–±–Ω–æ–≤–∏—Ç–µ –ø—É—Ç—å –∫ MCP —Å–µ—Ä–≤–µ—Ä—É –≤ `bot.py` (–ø—Ä–∏–º–µ—Ä–Ω–æ —Å—Ç—Ä–æ–∫–∞ 48):

```python
# –ë–´–õ–û (–ø—Ä–∏–º–µ—Ä):
MCP_WEATHER_SERVER_PATH = "/home/claude/mcp-weather-server/server.js"

# –ò–ó–ú–ï–ù–ò–¢–ï –Ω–∞ –≤–∞—à –ø—É—Ç—å:
MCP_WEATHER_SERVER_PATH = "/your/chosen/path/server.js"
```

### –®–∞–≥ 7: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ systemd
sudo systemctl restart telegram-bot
sudo journalctl -u telegram-bot -f

# –ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –≤—Ä—É—á–Ω—É—é
python3 bot.py
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
Conversations directory ready: /root/telegram-bot/conversations
‚úì MCP Weather Server started
MCP Weather Client initialized
Bot is running...
```

---

## ‚öôÔ∏è –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞

```python
# bot.py, —Å—Ç—Ä–æ–∫–∏ 50-105
class MCPWeatherClient:
    async def start(self):
        """–ó–∞–ø—É—Å–∫–∞–µ—Ç MCP —Å–µ—Ä–≤–µ—Ä –∫–∞–∫ subprocess"""
        self.process = await asyncio.create_subprocess_exec(
            'node', self.server_path,
            stdin=asyncio.subprocess.PIPE,
            stdout=asyncio.subprocess.PIPE,
            stderr=asyncio.subprocess.PIPE
        )
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è subprocess —Å Node.js
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è `server.js`
- –°–≤—è–∑—å —á–µ—Ä–µ–∑ stdio (stdin/stdout)

### 2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞

```python
# bot.py, —Å—Ç—Ä–æ–∫–∏ 818-835
tools = [{
    "name": "get_weather",
    "description": "–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –ø–æ–≥–æ–¥—É –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞...",
    "input_schema": {
        "type": "object",
        "properties": {
            "city": {
                "type": "string",
                "description": "–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞..."
            }
        },
        "required": ["city"]
    }
}]
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ Claude API –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- Claude –≤–∏–¥–∏—Ç —á—Ç–æ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `get_weather`
- –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –ø—Ä–æ –ø–æ–≥–æ–¥—É - Claude –≤—ã–∑—ã–≤–∞–µ—Ç —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞

```python
# bot.py, —Å—Ç—Ä–æ–∫–∏ 848-889
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ tool_use –≤ –æ—Ç–≤–µ—Ç–µ
tool_use_blocks = [block for block in response.content if block.type == "tool_use"]

if tool_use_blocks:
    for tool_use in tool_use_blocks:
        if tool_use.name == "get_weather":
            city = tool_use.input.get("city", "")
            
            # –í—ã–∑—ã–≤–∞–µ–º MCP —Å–µ—Ä–≤–µ—Ä
            result = await mcp_client.call_tool("get_weather", {"city": city})
            weather_data = result['content'][0]['text']
            
            # –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é
            messages.append({
                "role": "assistant",
                "content": serialize_message_content(response.content)
            })
            messages.append({
                "role": "user",
                "content": [{
                    "type": "tool_result",
                    "tool_use_id": tool_use.id,
                    "content": weather_data
                }]
            })
            
            # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
            final_response = client.messages.create(...)
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. Claude –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `tool_use` –±–ª–æ–∫ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –≥–æ—Ä–æ–¥–∞
2. –ë–æ—Ç –≤—ã–∑—ã–≤–∞–µ—Ç MCP —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ `mcp_client.call_tool()`
3. MCP —Å–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ Open-Meteo API
4. –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è Claude
5. Claude —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∫—Ä–∞—Å–∏–≤—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### 4. MCP Server –æ–±—Ä–∞–±–æ—Ç–∫–∞

```javascript
// server.js, —Å—Ç—Ä–æ–∫–∏ 138-186
server.setRequestHandler(CallToolRequestSchema, async (request) => {
  const city = request.params.arguments?.city;
  
  // 1. –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
  const location = await getCityCoordinates(city);
  
  // 2. –ü–æ–ª—É—á–∞–µ–º –ø–æ–≥–æ–¥—É
  const weather = await getCurrentWeather(
    location.latitude,
    location.longitude,
    location.timezone
  );
  
  // 3. –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
  const response = `üåç –ü–æ–≥–æ–¥–∞ –≤ –≥–æ—Ä–æ–¥–µ ${location.name}
üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${weather.temperature}¬∞C
‚òÅÔ∏è –°–æ—Å—Ç–æ—è–Ω–∏–µ: ${weatherDescription}
...`;
  
  return { content: [{ type: "text", text: response }] };
});
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å
```
–¢—ã: –ö–∞–∫–∞—è –ø–æ–≥–æ–¥–∞ –≤ –ú–æ—Å–∫–≤–µ?

–ë–æ—Ç: üåç –ü–æ–≥–æ–¥–∞ –≤ –≥–æ—Ä–æ–¥–µ Moscow, Russia
üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: -5¬∞C (–æ—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ -8¬∞C)
‚òÅÔ∏è –°–æ—Å—Ç–æ—è–Ω–∏–µ: –ü–∞—Å–º—É—Ä–Ω–æ
üíß –í–ª–∞–∂–Ω–æ—Å—Ç—å: 85%
üåßÔ∏è –û—Å–∞–¥–∫–∏: 0 –º–º
üí® –í–µ—Ç–µ—Ä: 12 –∫–º/—á (–°–ó)

üìä –¢–æ–∫–µ–Ω—ã: –≤–æ–ø—Ä–æ—Å 245 | –æ—Ç–≤–µ—Ç 156
```

### –¢–µ—Å—Ç 2: –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å
```
–¢—ã: –ö–∞–∫–∞—è –ø–æ–≥–æ–¥–∞ –≤ –¶—é—Ä–∏—Ö–µ?
–ë–æ—Ç: [–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–≥–æ–¥—É]

–¢—ã: –ê —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è?
–ë–æ—Ç: –î–∞, –¥–ª—è –¥–µ–∫–∞–±—Ä—è –≤ –¶—é—Ä–∏—Ö–µ 8¬∞C - —ç—Ç–æ –≤–ø–æ–ª–Ω–µ –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞...
```

### –¢–µ—Å—Ç 3: –ù–µ—Å–∫–æ–ª—å–∫–æ –≥–æ—Ä–æ–¥–æ–≤
```
–¢—ã: –°—Ä–∞–≤–Ω–∏ –ø–æ–≥–æ–¥—É –≤ –ú–æ—Å–∫–≤–µ –∏ –ü–∞—Ä–∏–∂–µ
–ë–æ—Ç: [–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–≤–∞–∂–¥—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ]
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
sudo journalctl -u telegram-bot -f
```

**–•–æ—Ä–æ—à–∏–µ –ª–æ–≥–∏:**
```
User 12345 | Mode: NORMAL | Message: –ö–∞–∫–∞—è –ø–æ–≥–æ–¥–∞...
Raw response type: tool_use
Claude wants weather for: –ú–æ—Å–∫–≤–∞
‚úì Successfully parsed JSON
Saved 12 messages for user 12345 (8456 bytes)
```

**–ü–ª–æ—Ö–∏–µ –ª–æ–≥–∏ (–æ—à–∏–±–∫–∏):**
```
‚ùå Error calling MCP weather tool: ...
Failed to start MCP Weather Server: ...
Object of type ToolUseBlock is not JSON serializable
```

---

## üîß Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞ 1: MCP —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º:**
```
Failed to start MCP Weather Server: [Errno 2] No such file or directory: 'node'
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Node.js —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
which node
node --version

# –ï—Å–ª–∏ –Ω–µ—Ç - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–µ–≤–µ—Ä–Ω—ã–π –ø—É—Ç—å –∫ server.js

**–°–∏–º–ø—Ç–æ–º:**
```
[Errno 2] No such file or directory: '/wrong/path/server.js'
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ù–∞–π–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å
find / -name "server.js" -type f 2>/dev/null | grep mcp

# –û–±–Ω–æ–≤–∏—Ç–µ –≤ bot.py
MCP_WEATHER_SERVER_PATH = "/correct/path/server.js"
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: ToolUseBlock –Ω–µ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º:**
```
TypeError: Object of type ToolUseBlock is not JSON serializable
```

**–†–µ—à–µ–Ω–∏–µ:**
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ bot.py –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è `serialize_message_content()` (—Å—Ç—Ä–æ–∫–∞ ~407) –∏ –æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ response.content –≤ –∏—Å—Ç–æ—Ä–∏—é (—Å—Ç—Ä–æ–∫–∞ ~866).

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω

**–°–∏–º–ø—Ç–æ–º:**
```
‚ùå –û—à–∏–±–∫–∞: –ì–æ—Ä–æ–¥ "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π–≥–æ—Ä–æ–¥" –Ω–µ –Ω–∞–π–¥–µ–Ω
```

**–†–µ—à–µ–Ω–∏–µ:**
–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - Open-Meteo API –Ω–µ –∑–Ω–∞–µ—Ç –≤—Å–µ—Ö –≥–æ—Ä–æ–¥–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ:
- –ù–∞–ø–∏—Å–∞—Ç—å –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
- –£–∫–∞–∑–∞—Ç—å –∫—Ä—É–ø–Ω—ã–π –≥–æ—Ä–æ–¥ –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 5: MCP —Å–µ—Ä–≤–µ—Ä –ø–∞–¥–∞–µ—Ç

**–°–∏–º–ø—Ç–æ–º:**
```
MCP Weather Server stopped unexpectedly
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ stderr
sudo journalctl -u telegram-bot | grep -A 10 "stderr"

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
node /path/to/server.js
# –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
```

---

## üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

### –ò–¥–µ—è 1: –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π

–î–æ–±–∞–≤—å—Ç–µ –≤ MCP —Å–µ—Ä–≤–µ—Ä –Ω–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `get_forecast`:

```javascript
{
  name: "get_forecast",
  description: "–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã –Ω–∞ 7 –¥–Ω–µ–π",
  input_schema: {
    type: "object",
    properties: {
      city: { type: "string" },
      days: { type: "number", default: 7 }
    }
  }
}
```

### –ò–¥–µ—è 2: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–†–∞—Å—à–∏—Ä—å—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ Open-Meteo API:
- UV –∏–Ω–¥–µ–∫—Å
- –í–æ—Å—Ö–æ–¥/–∑–∞–∫–∞—Ç —Å–æ–ª–Ω—Ü–∞
- –§–∞–∑–∞ –ª—É–Ω—ã
- –ö–∞—á–µ—Å—Ç–≤–æ –≤–æ–∑–¥—É—Ö–∞

```javascript
const url = `${WEATHER_API}?latitude=${lat}&longitude=${lon}&current=temperature_2m,uv_index,sunrise,sunset`;
```

### –ò–¥–µ—è 3: –î—Ä—É–≥–∏–µ MCP —Å–µ—Ä–≤–µ—Ä—ã

–°–æ–∑–¥–∞–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ MCP —Å–µ—Ä–≤–µ—Ä—ã:
- **mcp-news-server** - –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ RSS
- **mcp-currency-server** - –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç
- **mcp-crypto-server** - —Ü–µ–Ω—ã –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç
- **mcp-github-server** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤

### –ò–¥–µ—è 4: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–æ–±–∞–≤—å—Ç–µ –∫—ç—à –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API:

```javascript
const cache = new Map();
const CACHE_TTL = 10 * 60 * 1000; // 10 –º–∏–Ω—É—Ç

async function getCachedWeather(city) {
  const cached = cache.get(city);
  if (cached && Date.now() - cached.timestamp < CACHE_TTL) {
    return cached.data;
  }
  
  const data = await getCurrentWeather(...);
  cache.set(city, { data, timestamp: Date.now() });
  return data;
}
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Model Context Protocol Docs](https://modelcontextprotocol.io)
- [Anthropic Tools Documentation](https://docs.anthropic.com/claude/docs/tool-use)
- [Open-Meteo API Docs](https://open-meteo.com/en/docs)
- [MCP SDK –Ω–∞ GitHub](https://github.com/modelcontextprotocol/typescript-sdk)

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞—é—â–∞—è MCP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è! 

Claude –º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–≥–æ–¥–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∞ –≤—ã –º–æ–∂–µ—Ç–µ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–æ–±–∞–≤–ª—è—è –Ω–æ–≤—ã–µ MCP —Å–µ—Ä–≤–µ—Ä—ã.

**–£—Å–ø–µ—Ö–æ–≤!** üöÄ

---

**–ê–≤—Ç–æ—Ä:** –í–∏–∫—Ç–æ—Ä –ö—É–∑—å–º–∏–Ω  
**–î–∞—Ç–∞:** 16 –¥–µ–∫–∞–±—Ä—è 2024  
**–í–µ—Ä—Å–∏—è:** 3.0.0
